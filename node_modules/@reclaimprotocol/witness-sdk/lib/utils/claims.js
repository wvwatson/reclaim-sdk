"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.stringifyClaimParameters = exports.getIdentifierFromClaimInfo = exports.createSignDataForClaim = void 0;
const tls_1 = require("@reclaimprotocol/tls");
const canonicalize_1 = __importDefault(require("canonicalize"));
const ethers_1 = require("ethers");
function createSignDataForClaim(data) {
    const identifier = 'identifier' in data
        ? data.identifier
        : getIdentifierFromClaimInfo(data);
    const lines = [
        identifier,
        data.owner.toLowerCase(),
        data.timestampS.toString(),
        data.epoch.toString(),
    ];
    return lines.join('\n');
}
exports.createSignDataForClaim = createSignDataForClaim;
/**
 * Generates a unique identifier for given claim info
 * @param info
 * @returns
 */
function getIdentifierFromClaimInfo(info) {
    const str = `${info.provider}\n${info.parameters}\n${info.context || ''}`;
    return ethers_1.utils.keccak256((0, tls_1.strToUint8Array)(str)).toLowerCase();
}
exports.getIdentifierFromClaimInfo = getIdentifierFromClaimInfo;
function stringifyClaimParameters(params) {
    return (0, canonicalize_1.default)(params) || '';
}
exports.stringifyClaimParameters = stringifyClaimParameters;
