"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseResponse = void 0;
/**
 * Parse the html response for the ycombinator provider
 * Note: the classes may seem arbitrary,
 * but they are the only way to select the correct nodes
 */
function parseResponse(html) {
    const hasPersonalSidebarObject = parseHasCodeforcesPersonalSidebar(html);
    const userRatingInfoObject = parseUserInfoNode(html);
    return {
        hasPersonalSidebarObject,
        userRatingInfoObject
    };
}
exports.parseResponse = parseResponse;
function parseHasCodeforcesPersonalSidebar(html) {
    const matches = [...html.matchAll(/<div class="personal-sidebar">/g)].map(value => value.index);
    // console.log(matches);
    if (matches.length === 0) {
        throw new Error('Invalid login or an Unrated account');
    }
    return { hasPersonalSidebar: true };
}
const userRegexp = /<div class="personal-sidebar">\n.*\n.*\n.*Rating:.*>(\d*)<\/span>/g;
function parseUserInfoNode(html) {
    const matches = html.replace(/\r\n/g, '\n').match(userRegexp);
    const matchstrA = matches === null || matches === void 0 ? void 0 : matches[0].match(/Rating.*<\/span>/g);
    const matchstrB = matchstrA === null || matchstrA === void 0 ? void 0 : matchstrA[0].match(/>\d*<\//g);
    const matchstrC = matchstrB === null || matchstrB === void 0 ? void 0 : matchstrB[0].split('<');
    const matchstrD = matchstrC === null || matchstrC === void 0 ? void 0 : matchstrC[0].split('>');
    const matchstrE = matchstrD === null || matchstrD === void 0 ? void 0 : matchstrD[1];
    const rating = Number(matchstrE);
    return { rating: rating };
}
